// Module included in the following assemblies:
//
// * migrating_from_ocp_3_to_4/troubleshooting-3-4.adoc
// * migration_toolkit_for_containers/troubleshooting-mtc.adoc
// * backup_and_restore/application_backup_and_restore/troubleshooting.adoc

:_mod-docs-content-type: PROCEDURE
[id="migration-using-must-gather_{context}"]
= Using the must-gather tool

You can collect logs and information about {local-product} custom resources by using the `must-gather` tool.

The `must-gather` data must be attached to all customer cases.

The `must-gather` tool is a container and does not run all the time. The tool runs for a few minutes only after you start the tool by running the `must-gather` command.

ifdef::troubleshooting-3-4,troubleshooting-mtc[]
You can collect data for a one-hour or a 24-hour period and view the data with the Prometheus console.
endif::[]
ifdef::oadp-troubleshooting[]
You can use the `must-gather` tool with the following options. To use an option, add a flag corresponding to that option in the `must-gather` command.

Default configuration:: This configuration collects pod logs, {oadp-short}, and `Velero` custom resource (CR) information for all namespaces where the {oadp-short} Operator is installed.
Timeout:: Data collection might take a long time if there are many failed `Backup` CRs. You can improve performance by setting a timeout value.
Insecure TLS connections:: If a custom CA certificate is used, use the `must-gather` tool with  insecure TLS connections.

The `must-gather` tool generates a Markdown output file with the collected information. The Markdown file is located in a cluster directory.
endif::[]

.Prerequisites

* You must be logged in to the {product-title} cluster as a user with the `cluster-admin` role.
* You must have the OpenShift CLI (`oc`) installed.

ifdef::oadp-troubleshooting[]
* You must use {op-system-base-full} {op-system-version} with {oadp-short} 1.3.
endif::[]

.Procedure

. Navigate to the directory where you want to store the `must-gather` data.
. Run the `oc adm must-gather` command for one of the following data collection options:

ifdef::troubleshooting-3-4[]
* To collect data for the past hour, run the following command:
+
[source,terminal]
----
$ oc adm must-gather --image=registry.redhat.io/rhmtc/openshift-migration-must-gather-rhel8:v1.7
----
+
This command saves the data as the `must-gather/must-gather.tar.gz` file. You can upload this file to a support case on the link:https://access.redhat.com/[Red Hat Customer Portal].
* To collect data for the past 24 hours, run the following command:
+
[source,terminal]
----
$ oc adm must-gather --image=registry.redhat.io/rhmtc/openshift-migration-must-gather-rhel8:v1.7 -- /usr/bin/gather_metrics_dump
----
+
This operation can take a long time. This command saves the data as the `must-gather/metrics/prom_data.tar.gz` file.
endif::[]
ifdef::troubleshooting-mtc[]
* To collect data for the past 24 hours, run the following command:
+
[source,terminal]
----
$ oc adm must-gather --image=registry.redhat.io/rhmtc/openshift-migration-must-gather-rhel8:v1.8
----
+
This command saves the data as the `must-gather/must-gather.tar.gz` file. You can upload this file to a support case on the link:https://access.redhat.com/[Red Hat Customer Portal].
* To collect data for the past 24 hours, run the following command:
+
[source,terminal]
----
$ oc adm must-gather --image=registry.redhat.io/rhmtc/openshift-migration-must-gather-rhel8:v1.8 -- /usr/bin/gather_metrics_dump
----
+
This operation can take a long time. This command saves the data as the `must-gather/metrics/prom_data.tar.gz` file.
endif::[]
ifdef::oadp-troubleshooting[]
* To review the supported flags for the `oc adm must-gather` command, run the following command:
+
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather --image={must-gather-v1-3} -- /usr/bin/gather -h
----

* To use the default configuration of the `must-gather` tool, run the following command:
+
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather --image={must-gather-v1-3}
----

* To use the timeout flag with the `must-gather` tool, run the following command:
+
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather --image={must-gather-v1-3} -- /usr/bin/gather --request-timeout 1m # <1>
----
<1> In this example, the timeout is 1 minute.
* To use the insecure TLS connection flag with the `must-gather` tool, run the following command:
+
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather --image={must-gather-v1-3} -- /usr/bin/gather --skip-tls
----
* To use a combination of the insecure TLS connection and the timeout flags with the `must-gather` tool, run the following command:
+
[source,terminal,subs="attributes+"]
----
$ oc adm must-gather --image={must-gather-v1-3} -- /usr/bin/gather --request-timeout 15s --skip-tls #<1>
----
<1> In this example, the timeout is 15 seconds. By default, the `--skip-tls` flag value is `false`. Set the value to `true` to allow insecure TLS connections.

.Verification

. Verify that the Markdown output file is generated at the following location: `must-gather.local.89...054550/registry.redhat.io/oadp/oadp-mustgather-rhel9:v1.5-sha256-0...84/clusters/a4...86/oadp-must-gather-summary.md`

. Review the `must-gather` data in the Markdown file by opening the file in a Markdown previewer. For an example output, refer to the following image. You can upload this output file to a support case on the link:https://access.redhat.com/[Red{nbsp}Hat Customer Portal].
+
.Example markdown output of must-gather tool
image::oadp-must-gather-markdown-output.png[must-gather markdown output]
endif::[]
